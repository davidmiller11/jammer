<!-- show.html.erb - jams -->
<h2>Jam: <%= @jam.name %></h2>

<p>
  <div>
    <strong>Location:</strong> <%= @jam.location %>
  </div>
  <div>
    <strong>Description:</strong> <%= @jam.description %>
  </div>
  <div>
    <strong>Finalized?</strong> <%= @jam.finalized %>
  </div>

  <div>
    <strong>Created by:</strong> <%= User.find(@jam.user_id).full_name %>
  </div>

  <div>
    <strong>Created at:</strong> <%= @jam.created_at %>
  </div>
</p>

<% if !@jam.jam_times.empty? %>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <% @jam.jam_times.order(:start_time).order(:start_date).each do |jam_time| %>
        <th><%= "#{jam_time.start_date} #{jam_time.start_time}" %></th>
      <% end %>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @jam.guest_ids.each do |guest_id| %>
      <tr>
        <td><%= User.find(guest_id).full_name %></td>
        <% @jam.jam_times.order(:start_time).order(:start_date).each do |jam_time| %>
          <% p jam_time %>
          <% @rsvp = Rsvp.find_by(:jam_time_id => jam_time.id, :user_id => guest_id) %>
          <td><%= @rsvp.answer %></td>
        <% end %>
        
        <% if current_user.id == guest_id || current_user.admin %>
        <td>
          <%= link_to 'Edit', edit_rsvp_path(@rsvp) %>
            </td>
          <td>
            <%= link_to 'Delete', @rsvp, method: :delete, data: { confirm: "Are you sure??"} %>
          </td>
        <% end %>
        
      </tr>
    <% end %>
  </tbody>
</table>

<% end %>

<p>
<% session[:jam_id] = @jam.id %>
<div><%= link_to 'Add another time', new_jam_time_path %></div>
<div><%= link_to 'Invite friends', new_rsvp_path %></div>
<div><%= link_to 'Edit', edit_jam_path(@jam) %></div>
<div><%= link_to 'Delete', jam_path(@jam), method: :delete, data: { confirm: 'Sure you wanna delete this Jam?'} %></div>
<div><%= link_to 'Back', jams_path %></div>
</p>
